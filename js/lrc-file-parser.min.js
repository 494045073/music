/*!
 * lrc-file-parser.js v0.1.15
 * Author: lyswhut
 * Github: https://github.com/lyswhut/lrc-file-parser
 * License: MIT
 */
!function(i,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("Lyric",[],t):"object"==typeof exports?exports.Lyric=t():i.Lyric=t()}(window,(function(){return function(i){var t={};function e(n){if(t[n])return t[n].exports;var r=t[n]={i:n,l:!1,exports:{}};return i[n].call(r.exports,r,r.exports,e),r.l=!0,r.exports}return e.m=i,e.c=t,e.d=function(i,t,n){e.o(i,t)||Object.defineProperty(i,t,{enumerable:!0,get:n})},e.r=function(i){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(i,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(i,"__esModule",{value:!0})},e.t=function(i,t){if(1&t&&(i=e(i)),8&t)return i;if(4&t&&"object"==typeof i&&i&&i.__esModule)return i;var n=Object.create(null);if(e.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:i}),2&t&&"string"!=typeof i)for(var r in i)e.d(n,r,function(t){return i[t]}.bind(null,r));return n},e.n=function(i){var t=i&&i.__esModule?function(){return i.default}:function(){return i};return e.d(t,"a",t),t},e.o=function(i,t){return Object.prototype.hasOwnProperty.call(i,t)},e.p="",e(e.s=0)}([function(i,t){function e(i){return function(i){if(Array.isArray(i)){for(var t=0,e=new Array(i.length);t<i.length;t++)e[t]=i[t];return e}}(i)||function(i){if(Symbol.iterator in Object(i)||"[object Arguments]"===Object.prototype.toString.call(i))return Array.from(i)}(i)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function n(i,t){for(var e=0;e<t.length;e++){var n=t[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(i,n.key,n)}}var r=/^\[([\d:.]*)\]{1}/g,s={title:"ti",artist:"ar",album:"al",offset:"offset",by:"by"},o=performance.now?performance.now.bind(performance):Date.now.bind(Date),u={invokeTime:0,animationFrameId:null,timeoutId:null,callback:null,drift:null,isDrifted:!1,thresholdTime:1e3,run:function(){var i=this;this.animationFrameId=window.requestAnimationFrame((function(){var t=parseInt(i.invokeTime-o());return t>0?t<i.thresholdTime?i.run():i.timeoutId=setTimeout((function(){i.run(),i.timeoutId=null}),t-800):(t*=-1)>50?(i.isDrifted=!0,void i.drift(t)):(i.callback(t),void(i.animationFrameId=null))}))},start:function(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){},e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e3;this.callback=i,this.drift=t,this.invokeTime=o()+e,this.isDrifted=!1,this.run()},clear:function(i){null==this.animationFrameId&&null==this.timeoutId||(this.animationFrameId&&(window.cancelAnimationFrame(this.animationFrameId),this.animationFrameId=null),this.timeoutId&&(window.clearTimeout(this.timeoutId),this.timeoutId=null),!this.isDrifted&&i&&o()-this.invokeTime>100&&i(o()-this.invokeTime))}};i.exports=function(){function i(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.lyric,n=void 0===e?"":e,r=t.offset,s=void 0===r?150:r,o=t.onPlay,u=void 0===o?function(){}:o,a=t.onSetLyric,l=void 0===a?function(){}:a;!function(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),this.lyric=n,this.tags={},this.lines=null,this.onPlay=u,this.onSetLyric=l,this.isPlay=!1,this.curLineNum=0,this.maxLine=0,this.offset=s,this.isOffseted=!1,this._init()}var t,o,a;return t=i,(o=[{key:"_init",value:function(){this.lyric&&(this._initTag(),this._initLines(),this.onSetLyric(this.lines))}},{key:"_initTag",value:function(){for(var i in s){var t=this.lyric.match(new RegExp("\\[".concat(s[i],":([^\\]]*)]"),"i"));this.tags[i]=t&&t[1]||""}}},{key:"_initLines",value:function(){this.lines=[];for(var i=this.lyric.split("\n"),t=0;t<i.length;t++){var n=i[t].trim();if(r.exec(n)){var s=n.replace(r,"").trim();if(s){var o=RegExp.$1.split(":");o.length<3&&o.unshift(0),o[2].indexOf(".")>-1&&(o.push.apply(o,e(o[2].split("."))),o.splice(2,1)),this.lines.push({time:60*parseInt(o[0])*60*1e3+60*parseInt(o[1])*1e3+1e3*parseInt(o[2])+parseInt(o[3]||0),text:s})}}}this.lines.sort((function(i,t){return i.time-t.time})),this.maxLine=this.lines.length-1}},{key:"_findCurLineNum",value:function(i){for(var t=this.lines.length,e=0;e<t;e++)if(i<=this.lines[e].time)return 0===e?0:e-1;return t-1}},{key:"_refresh",value:function(i){var t=this;return this.curLineNum++,this.onPlay(this.curLineNum,this.lines[this.curLineNum].text),this.curLineNum===this.maxLine?this.pause():(this.delay=this.lines[this.curLineNum+1].time-this.lines[this.curLineNum].time-i,!this.isOffseted&&this.delay>=this.offset&&(this.delay-=this.offset,this.isOffseted=!0),this.delay<=0?this._refresh(this.delay):void u.start((function(i){t._refresh(i)}),(function(i){t.play(t.lines[t.curLineNum+1].time+i)}),this.delay))}},{key:"play",value:function(){var i=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(this.lines.length){if(this.pause(),this.isPlay=!0,this.curLineNum=this._findCurLineNum(t),this.onPlay(this.curLineNum,this.lines[this.curLineNum].text),this.curLineNum===this.maxLine)return this.pause();this.delay=this.lines[this.curLineNum+1].time-t,this.delay>=this.offset&&(this.delay-=this.offset,this.isOffseted=!0),this.delay<0||u.start((function(t){i._refresh(t)}),(function(t){i.play(i.lines[i.curLineNum+1].time+t)}),this.delay)}}},{key:"pause",value:function(){var i=this;this.isPlay&&(u.clear((function(t){if(i.curLineNum!==i.maxLine){var e=i._findCurLineNum(i.lines[i.curLineNum+1].time+t);i.onPlay(e,i.lines[e].text)}})),this.isPlay=!1,this.isOffseted=!1)}},{key:"setLyric",value:function(i){this.isPlay&&this.pause(),this.lyric=i,this._init()}}])&&n(t.prototype,o),a&&n(t,a),i}()}])}));